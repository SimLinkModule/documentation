%!TEX root = ../Studienarbeit.tex

\chapter{Validierung und Gegenüberstellung}

\section{Validierung des Funktionsumfangs}

In diesen Abschnitt der Studienarbeit soll der definierte Aufgabenumfang von Kapitel \ref{section:Aufgabenstellung} mit dem realisierten Umfang verglichen werden und gegebenenfalls vorhandene Einschränkungen erläutert werden.

\subsection{Softwareentwicklung}
Die Anforderungen an die Software des Erweiterungsmoduls sind in Kapitel \ref{section:softwareRequirement} aufgelistet und werden alle nacheinander in diesem Unterkapitel mit der finalen Umsetzung verglichen.

Die erste Anforderung ist die Unterstützung der Kommunikation des Erweiterungsmoduls mit Endgeräten auf denen das Betriebssystem Android, Windows, Linux oder iOS/iPadOS läuft. Getestet wurde das Erweiterungsmodul mit allen gennanten Betriebssystemen unter einer Betriebssystemversion und einer Simulatorsoftware. Getestet wurde das Erweiterungsmodul unter Android Version 10 und der Simulatorsoftware \textit{FPV.SkyDive}, dabei konnte der vollständige Funktionsumfang nachgewiesen werden. Unter Windows 11 mit der Simulatorsoftware \textit{Velocidrone} konnte ebenso der vollständige Funktionsumfang des Erweiterungsmoduls nachgewiesen werden. Als Linux-Betriebssystem wurde \textit{Pop! OS 22.04 LTS} mit der Simulatorsoftware \textit{Velocidrone} verwendet. Dort konnte gleichermaßen der vollständige Funktionsumfang nachgewiesen werden. Für die Überprüfung des Funktionsumfangs des Erweiterungsmoduls mit iOS/iPadOS 16.3.1 wurde die Simulatorsoftware \textit{FPV.SkyDive} verwendet. Dort konnte keine Funktionsfähigkeit nachgewiesen werden. Jedoch findet unter iOS/iPadOS ein Verbindungsaufbau zwischen dem Erweiterungsmodul und dem Engerät statt und ebenfalls werden die Daten vom Erweiterungsmodul empfangen. Nachgewiesen werden kann dies mit der Software \textit{packetLogger} und \textit{libimobiledevice}. Für weitere Untersuchungen wurde ebenfalls ein vorhandender, mit iOS/iPadOS kompatibler, Nintendo Switch-Controller herangezogen und betrachtet wie der Kommunikationsaustausch dort stattfindet. Dabei stellt sich heraus, dass der Nintendo Switch-Controller mittels \ac{BBR} arbeitet und die Daten nicht mittels \ac{BLE} übertragt. Wie in Quelle \cite{lemmingDevESP32Comment} beschrieben ist, müssen \ac{BLE}-Gamecontroller doch durch das \ac{MFi}-Programm zertifiziert werden und ein zusätzliches Hardwaremodul enthalten muss.

Die zweite Anforderung an die Software ist, dass die Kommunikation zwischen dem Erweiterungsmodul und den Endgeräten mittels \ac{BLE} erfolgen und sich das Erweiterungsmodul als HID-Gerät authentifizieren soll. Diese Umsetzung dieser Anforderung ist in Kapitel \ref{section:bluetoothStackSelection} und \ref{section:communicationModuleDevice} beschrieben.

Die dritte Anforderung ist, dass die Kommunikation zwischen dem Erweiterungsmodul und der Multikopterfernsteuerung über den Modulschacht der Fernsteuerung erfolgen soll. Auch soll die Kommunikation mittels eines vorhandenes Protokolls der Fernsteuerungsfirmware OpenTX oder einer Abspaltung davon erfolgen. Als Kommunikationsprotokoll zwischen dem Erweiterungsmodul und der Multikopterfernsteuerung wird CRSF verwendet wie in Kapitel \ref{section:communicationCRSF} nachgelesen werden kann. Getestet wurde die Erweiterungsmodulsoftware mit der Multikopterfernsteuerung Tango 2 von Team Blacksheep mit der Firmware FreedomTX Version TBS-1.3.0. Dabei wurde festgestellt, dass alle versendeten Kanaldaten mittels dem CRSF-Protokoll empfangen und verarbeitet werden können.

Die vierte Anforderung ist, dass es verschiedene Ein- und Ausgabemöglichkeiten geben soll für die Interaktion mit dem Erweiterungsmodul durch den Benutzer des Erweiterungsmoduls. Dafür wird einerseits für die Ausgabe von Statusnachrichten ein \acs{OLED}-Display verwendet, wie in Kapitel \ref{section:oledOutput} beschrieben ist. Zusätzlich gibt es Taster für Eingaben durch einen Benutzer, nachzulesen in Kapitel \ref{section:softwareCombination}. Ebenfalls war ein Teil dieser Anforderung, dass \acp{LED} vorhanden sein sollen als weitere Statusindikatoren. Dies ist jedoch nicht umgesetzt worden, da alle wichtigen Statusnachrichten für den Benutzer durch das \ac{OLED}-Display angezeigt werden können. Jedeglich eine Status-\ac{LED} ist vorhanden, um anzuzeigen, ob eine funkionierende Stromzufuhr zum Erweiterungsmodul vorhanden ist. Dies ist jedoch komplett in Hardware realisiert, siehe Abbildung \ref{fig:spannungsRegulierung}.


Die letzte Anforderung an die Software ist, dass der Akkustand der Multikopterfernsteuerung an das Endgerät übermittelt wird. Die Softwarekomponente hierfür ist vollständig vorhanden und funktionsfähig, jedoch bietet der Lite-Modulschachtstecker keinen Pin, welcher die rohe Akkuspannung ausgibt (zu sehen in Abbildung \ref{fig:pinoutController}). Aus diesem Grund wird im \ac{BLE}-Akkustand-Merkmal immer der Wert 0 übertragen. Dadurch wird sichergestellt, dass der Benutzer des Erweiterungsmoduls selbst den aktuellen Akkustand der Multikopterfernsteuerung überprüft, da er davon ausgehen kann das es sich um ein Fehlverhalten des Erweiterungsmoduls handelt.

\subsection{Platinenentwurf}
Die Anforderungen an die entworfenen Platinen des Erweiterungsmoduls sind in Kapitel \ref{section:pcbRequirement} aufgelistet und beschreiben, dass die Platine alle benötigten Elektronikkomponenten für das Erweiterungsmodul, welche im prototypischen Steckbrettaufbau vorhanden sind enthalten muss. Zusätzlich sollte die Platine möglichst kompakt sein, damit die Platine an der Multikopterfernsteuerung verwendet werden kann ohne das diese während des Steuerns von Multikoptern stört. Diese Anforderungen wurden alle in den Platinen, welche in Kaptiel \ref{section:pcbImplementation} vorgestellt worden, umgesetzt. Die Platine enthält den ESP32-Mikrocontroller, die benötigte Spannungsregulierung für alle Elektronikkomponenten sowie Taster, ein Display und eine \ac{LED} für die Interaktion mit dem Benutzer des Erweiterungsmoduls. Zusätzlich enthält die externe Platinenbuchse einen Schutz vor \ac{ESD} und eine Logik für die komfortablere Programmierung des ESP32-Mikrocontrollers.

\subsection{Gehäuseerstellung}
Die Anforderungen an das Erweiterungsmodulgehäuse sind in Kapitel \ref{section:caseRequirement} aufgelistet und umfassen den Entwurf eines Kunststoffgehäuses, welches für Modulschächte des Typs \textit{Lite} verwendet werden kann und möglichst ohne Nachbearbeitung verwendet werden kann. All diese Anforderungen sind im entworfenen Gehäuse von Kapitel \ref{section:caseImplementation} umgesetzt. Das vorgestellte Gehäuse ist für Erweiterungsmodulschächte des Typs \textit{Lite} und kann mit vier Stützstrukturen gedruckt werden. Ebenfalls müssen nach dem Entfernen der Stützstrukturen ohne Nachbearbeitung der Oberflächen verwendet werden, da die Stützstrukturen in einen nicht sichtbaren Bereich des Gehäuses verwendet werden.

\section{Gegenüberstellung \acs{BLE}-Modul und USB-Verbindung}
Um zu überprüfen, ob das \ac{BLE}-Erweiterungsmodul eine bemerkbare Latenz für die weitergabe einzelner Eingaben aufweist, wurden nachfolgend beschriebene Versuchsaufbauten zur Auswertung verwendet.

\subsection{Versuchsaufbau}
%Test zunächst mit servo probiert, um nicht an Platine direkt arbeiten zu müssen. Jedoch ist der Delay nicht in einen glaubwürdigen bereich, da zu lang.
%Eine Studie gefunden, bei dem optokoppler verwendet wurden, und verschiedene Geräte getestet wurde als vergleichswert verwendbar.
%Dadurch neuer Versuchsaufbau mit optokoppler. Schauen ob es in einen bereich mit den restlichen ist und wie viel schlechter es wurde.
%Schreiben das mit evdev ermittelt wird und welche latenzen im System vorhanden sind --> Bild dafür hinzufügen

%Bild von alter Haltung mit dem Servo zeigen
%Bild von der Schaltung noch machen in KiCad

\subsection{Auswertung}
%Vielleicht gaußverteilung darstellen und werte dafür raussrechnen. Schreiben dass x mal getestet wurde.
%Vergleich mit der anderen arbeit aus regensburg gegenüberstellen.
%Berechnen was für eine Strecke geflogen wird in 30ms. Geschwindigkeit von Renndrohnen und normalen drohnen ausrechnen. Dabei jedoch schreiben, dass es in relation gesehen werden muss, dass pro neuen Signal nur immer von relativen Anpassungen der Flugbahn ausgegangen werden muss und nicht von 
%Auch noch schreiben, dass die Testperson (ein Hobbiedrohnenpilot) keinen merkbaren unterschied zwischen einer USB-Verbindung und BLE-Verbindung ausmachen konnte im Simulator.
%Schreiben wieso diese zusätzliche Latenz zu stande kommt und die ausreißer.
    %-nicht jedes CRSF für die Tastenstellungen
    %-Übertragungsrate von BLE
    %-Doppelte Umwandlung in verschiedene Protokolle
%auch sollten die einzelnen ausgefallenen Pakete oder die nach 100ms nicht all zu fehlerbehaftet gesehen werden, da sich ständig werte ändern während der flug einer drohne und nicht nur ein einziges signal sich ändert wodurch viel häufiger die alle Controller-Daten an das Endgerät gesendet werden
%schreiben wieso es so spikes an gewissen stellen gibt
    %-Ist von der Pollingrate von BLE und USB abhängig