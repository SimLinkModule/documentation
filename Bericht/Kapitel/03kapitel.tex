%!TEX root = ../Studienarbeit.tex

\chapter{Technische Grundlagen}

\section{\acf{HID}}

\subsection{Allgemein}

\subsection{Report Deskriptor}

\section{Bluetooth}

\subsection{Allgemein}

Bluetooth ist ein Kurzstreckenkommunikationssystem, bei welchen die Hauptmerkmale auf Robustheit, einen geringen Stromverbrauch und geringe Kosten gelegt wurde. Bluetooth wir in zwei Kategorien aufgeteilt. Die erste Kategorie ist \ac{BBR}. Die zweite Kategorie ist \ac{BLE}. Beide Kategorien beinhalten dabei Mechanismen, um Bluetooth-Geräte zu entdecken, einen Verbindungsaufbau durchzuführen sowie eine Verbindung herzustellen. Das Augenmerk bei \ac{BLE} Produkten liegt dabei auf einen niedrigen Stromverbrauch, welche durch eine geringere Datenrate und eine geringere Einschaltdauer während den Datenaustausch als bei \ac{BBR} realisiert wird. Die Übertragungsrate bei \ac{BLE} in der physikalischen Schicht beträgt 2~MB/s. Zu beachten ist, dass ein Bluetooth-Controller entweder nur \ac{BLE}, \ac{BBR} oder beide Bluetooth-Kategorien unterstützen kann. \cite[S.~187]{bluetoothCore}

Die Übertragungsfrequenz von \ac{BLE} ist im lizenzfreien 2.4~GHz \acf{ISM}-Band von 2402~MHz bis 2480~MHz \cites[S.~4]{siliconBLE}[S.~190]{bluetoothCore}. Das Frequenzband ist in 40 physikalische Kanäle mit jeweils einer Bandbreite von 2~MHz aufgeteilt, wie in Abbildung \ref{fig:frequenzbandBLE} zu sehen ist \cite[S.~190]{bluetoothCore}. Drei dieser 40 physikalischen Kanäle sind für das sogenannte Advertising vorhanden ()\cite[S.~190]{bluetoothCore}, welches für die Geräteentdeckung, den Verbindungsaufbau und für das Broadcasting von Nachrichten vorhanden ist \cite[S.~4]{siliconBLE}. Die restlichen Kanäle sind für eine allgemeine Datenübertragung vorhanden \cite[S.~190]{bluetoothCore}. Zusätzlich zu der Aufteilung des Frequenzbandes in Kanäle werden Kanäle in Zeiteinheiten aufgeteilt, welche Events genannt werden \cite[S.~190]{bluetoothCore}. Daten werden in Paketen innerhalb eines Events übertragen. Zusätzlich wird bei der Übertragung von Daten Frequenzhopping betrieben, welches zu Beginn jedes Events stattfindet \cite[S.~190f.]{bluetoothCore}. 

\begin{figure}[h]
\centering
\includegraphics[height=.3\textwidth]{frequenzband}
\caption{Frequenzband mit Kanälen von \ac{BLE}; Abgewandelt von \cite[S.~4]{siliconBLE}}
\label{fig:frequenzbandBLE}
\end{figure}

Die Kompatibilität zwischen Bluetooth-Geräten wird durch sogenannte Profile sichergestellt. Profile beschreiben dafür Funktionen und Eigenschaften von jeder Schicht im Bluetoothsystem \cite[S.~277]{bluetoothCore}. Ebenso werden die benötigten Nachrichten und Prozeduren für die verwendeten Profile durch die Bluetooth \ac{SIG} spezifiziert \cite[S.~1241]{bluetoothCore}.

Bluetooth-Geräten werden unterschiedliche Rollen zugewiesen. Dafür gibt es die Rollen Observer, Broadcaster, Central und Peripheral. Ein Gerät in der Rolle Broadcaster verschickt Advertising-Pakete und ein Gerät welches nur Advertising-Pakete empfangen kann hat die Observer Rolle. So kann eine einseitige Kommunikation zwischen Geräten mittels Advertising-Paketen erfolgen. Eine andere Art der Kommunikation ist mittels einer Verbindung bei dem das Initiatorgerät eine Verbindungsanfrage eines Broadcastergeräts annimmt. Daraufhin bekommt das Initiatorgerät die Rolle Central und das Gerät welches ursprünglich in der Rolle Broadcaster war, die Rolle Peripherial. Anzumerken ist, dass ein Gerät zu jeder Zeit mehrere Rollen unterstützen kann, welche jedoch alle der Bluetooth-Controller unterstützen muss. \cite[S.~190f., S.~278, S.~1246ff.]{bluetoothCore}

\subsection{Benötigte Komponenten eines \ac{BLE}-Geräts}

Ein \ac{BLE}-Gerät benötigt einen Mindestumfang an Funktionen damit es laut Bluetooth \ac{SIG} \ac{BLE} kompatibel ist. In Abbildung \ref{fig:blestack} sind die benötigten Funktionen und deren Zusammenspiel durch ein Schichtenmodell dargestellt. Die Funktionen können dabei in einen Hostteil und einen Controllerteil aufgeteilt werden. Im Hostteil befinden sich die Funktionen \ac{L2CAP}, \ac{GAP}, \ac{ATT}, \ac{GATT}, \ac{SDP} und \ac{SMP}. Im Controllerteil befinden sich die Funktionen \ac{PHY} und \ac{LL}. Die Kommunikation zwischen den Hostteil und dem Controllerteil finden mittels des \ac{HCI} statt \cite[S.~1735]{bluetoothCore}. \cite[S.~193]{bluetoothCore}

\begin{figure}[h]
    \centering
    \includegraphics[width=.25\paperheight]{blestack}
    \caption{Benötigte Komponenten eines \acs{BLE}-Geräts; Abgewandelt von \cite[S.~203, S.~1245]{bluetoothCore}}
    \label{fig:blestack}
\end{figure}

In den nachfolgenden Unterkapiteln werden die wichtigsten Informationen jeder benötigten Funktion von \ac{BLE} beschrieben.

\subsubsection{\acf{PHY}}
Die physikalische Schicht in \ac{BLE} ist zum Verschicken und erhalten von Paketen über eines der physikalischen Funkkanäle verantwortlich. \cite[S.~209]{bluetoothCore}

\subsubsection{\acf{LL}}
Die Verbindungsschicht im \ac{BLE}-System besteht aus mehreren Komponenten. Eine Komponente ist für die Erstellung, Modifizierung und das Freigeben von logischen Verbindungen zuständig. Eine weitere Komponente ist für das Kodieren und Dekodieren von Bluetooth Paketen zuständig. Auch gibt es eine Komponente welche für die Datenflusskontrolle, die Datenbestätigung und für die Wiederübertragung von Paketen zuständig ist. Die letzten Komponenten in der Verbindungsschicht ist für den Zugriff auf das Radiomedium zuständig. Dafür gibt es einen Scheduler, welcher Zeitschlitze des physikalischen Mediums an die höherliegenden Dienste verteilt. \cite[S.~207f.]{bluetoothCore}

\subsubsection{\acf{HCI}}
Das \acl{HCI} stellt die Möglichkeit bereit, dass der Hostteil die Funktionen des Controllerteil erreichen kann. Die Übertragung des \ac{HCI} kann dabei wahlweise mittels USB, UART oder anderen Bussystemen stattfinden. \cite[S.~1735f.]{bluetoothCore}

\subsubsection{\acf{L2CAP}}
Das \acl{L2CAP} ist die Schicht im \ac{BLE}-Stack, welches eine kanalbasierte Abstraktion zu den Applikationen und Diensten der höheren Schichten bereitgestellt. Diese Schicht kümmert sich zusätzlich, um die Segmentierung, den Zusammenbau, das Multi- und Demultiplexing von Daten auf einer beziehungsweise mehreren logischen Verbindungen. \cite[S.~195, S.~1013]{bluetoothCore}

\acl{L2CAP} baut dabei auf dem Konzept von logischen Kanälen auf, wobei jeder Endpunkt eines logischen Kanals einen eindeutigen \ac{CID} hat \cite[S.~1021]{bluetoothCore}. Die logischen Kanäle werden über logische Verbindungen der \ac{LL}-Schicht übertragen \cite[S.~1013]{bluetoothCore}.

\subsubsection{\acf{GAP}}
Das \acl{GAP} beschreibt die Basisfunktionalitäten welche ein \ac{BLE}-Gerät benötigt \cite[S.~207]{bluetoothCore}. Dabei werden auch alle, in diesem Kapitel vorgestellten Schichten als Mindestanforderung aufgelistet und die alle benötigten Fähigkeiten die eine \ac{BLE}-Rolle benötigt \cite[S.~277f., S.~1241]{bluetoothCore}. 

Weitere wichtige Eigenschaften die in \ac{GAP} definiert sind, ist zum einen die Bluetooth-Geräteadresse. Diese Geräteadresse wird verwendet, um ein Bluetooth-Gerät eindeutig zu identifizieren. Eine weitere Eigenschaft, welche in \ac{GAP} definiert wird, ist der Gerätename. Dieser Name ist eine benutzerfreundliche Zeichenfolge der an entfernten Geräten angezeigt wird. Der Gerätename kann bis zu 248~Byte lang sein und sollte in UTF-8 kodiert sein. Es muss davon ausgegangen werden, dass ein Gerät nur die ersten 40 Zeichen verwenden kann. \cite[S.~1251ff.]{bluetoothCore}

Damit eine Verfolgung von Geräteadressen minimiert werden kann, gibt es in \ac{BLE} zwei Arten von Geräteadressen. Zum einen eine sich verändernde öffentliche Adresse, welche an allen \ac{BLE}-Geräte verschickt wird. Zum anderen gibt es sich nicht verändernde private Adressen, welche von Geräten ausgerechnet werden kann, welche schon einmal eine Verbindung mit dem Gerät aufgebaut haben. Damit können Geräte, welche schon einmal mit einem anderen Gerät verbunden waren, überprüfen, ob es sich um ein bereits bekanntes Gerät handelt. \cite[S.~18]{siliconBLE}

Auch wird in \ac{GAP} beschrieben, wie der Bluetooth-Pin für eine Authentifizierung zweier Geräte im Verbindungsmodus aufgebaut sein muss. Diese Pin ist sechs Zeichen lang und besteht aus Ziffern. \cite[S.~1253]{bluetoothCore}

Zu guter Letzt, beschreibt \ac{GAP} noch die verschieden Sicherheitsmodi, welche durch die verschiedenen \ac{BLE}-Rollen implementiert sein müssen \cite[S.~1337]{bluetoothCore}.

\subsubsection{\acf{SDP}}
\ac{SDP} stellt die Möglichkeit bereit, die verfügbaren Dienste und die zugehörigen Merkmale eines Bluetooth-Geräts für entfernte Geräte sichtbar zu machen \cite[S.~1173]{bluetoothCore}. Dabei pflegt das Gerät, welches \ac{SDP} bereitstellt, eine Liste aller Dienste und Merkmale des Geräts \cite[S.~1177]{bluetoothCore}.

\subsubsection{\acf{SMP}}
\ac{SMP} definiert Methoden zum Verbindungsaufbau und zum Schlüsselaustausch zwischen Bluetooth-Geräten \cite[S.~1554]{bluetoothCore}. Die gerätespezifischen Schlüssel, werden für die Identifizierung von Geräten und für den verschlüsselten Datenaustausch zwischen Geräten verwendet \cites[S.~1556]{bluetoothCore}[S.~18]{siliconBLE}.

Der Verbindungsaufbau und der dazugehörige Schlüsselaustausch für die Identifizierung der Geräte erfolgt in 3 Phasen. Die erste Phase ist die Anfrage für einen Verbindungsaufbau. Die zweite Phase, nach einer erfolgreichen Anfrage, ist die Generierung eines Schlüssels mit einer kurzen oder langen Lebenszeit. Die letzte Phase ist die Bereitstellung der generierten Schlüssel an die Gegenstelle. \cite[S.~1556]{bluetoothCore}

Zu beachten ist, dass es verschiedene Möglichkeiten gibt einen Verbindungsaufbau herzustellen, der abhängig von den Sicherheitsansprüchen der Anwendung definiert werden kann \cite[S.~18]{siliconBLE}.

\subsubsection{\acf{ATT}}
\ac{ATT} ist ein Teilnehmer-zu-Teilnehmer Protokoll zwischen zwei Geräten \cite[S.~206]{bluetoothCore}. \ac{ATT} definiert dabei zwei Rollen, den Client und den Server \cite[S.~1410]{bluetoothCore}. \ac{ATT} erlaubt es Geräten -- Clients -- kleine Werte -- sogenannte Attribute \cite[S.~279]{bluetoothCore} -- zu lesen, zu schreiben und zu entdecken, welche sich auf dem Gerät mit der Rolle Server befinden \cite[S.~1409]{bluetoothCore}. Ein Gerät kann simultan in der Rolle Server und Client sein \cite[S.~279]{bluetoothCore}.

Ein Attribut besteht jeweils aus drei Eigenschaften. Die erste Eigenschaft ist der Attribut-Typ, welcher durch eine \acf{UUID} definiert wird und in \ac{SDP} definiert sind. Die zweite Eigenschaft ist der Attribut-Handle. Der Attribut-Handle ist ein einzigartiger Identifikator für ein Attribut auf einem Gerät mit der Server-Rolle. Dadurch das Handle ist das Attribut eindeutig auf dem Gerät definiert. Die letzte Eigenschaft eines Attributs sind die Berechtigungen, welche durch eine höhere Schicht definiert werden muss. \cite[S.~1410ff.]{bluetoothCore}

Attribut-Handles haben eine Länge von 16~Bit und können durch weitere spezielle Attribute gruppiert werden \cite[S.~1412f.]{bluetoothCore}. Die Entdeckung aller vorhandenen Attribute eines Servers durch einen Client erfolgt durch eine höhere Schicht des \ac{BLE}-Stacks \cite[S.~1410]{bluetoothCore}.

Die hinterlegten Werte eines Attributs bestehen aus einem Oktett-Array mit einer fixen oder variablen Länge \cite[S.~1413]{bluetoothCore}.

\subsubsection{\acf{GATT}}
\ac{GATT} baut auf \ac{ATT} auf und stellt ein Framework für die Daten, welche in \ac{ATT} gespeichert werden, bereit. \ac{GATT} stellt wie \ac{ATT} zwei Rollen -- den Server und den Client -- bereit. Ebenso definiert \ac{GATT} das Format der Daten, welche auf dem \ac{GATT}-Server gespeichert werden dürfen, in sogenannten Profilen. Attribute werden hierfür in Profile, Dienste und Merkmale untergliedert, wie in Abbildung \todo{Referenz hinzufügen} zu sehen ist. Ein Applikationsprofil besteht aus einen oder mehreren Diensten, um bestimmte, definierte Use-Cases abzudecken und definiert darüber hinaus die benötigten Dienste, Merkmale und Attribute \cite[S.~207]{bluetoothCore}. Ein Dienst enthält eine Ansammlung von Merkmalen und kann andere Dienste inkludieren. Ein Merkmal enthält ein Wert, sowie eine Menge von Deskriptoren. Durch diesen Aufbau ist es einen Client möglich die Daten eines bestimmten Profils auszulesen ohne davor den Aufbau der Attribute des Servers kennen zu müssen. \cite[S.~280, S.~1480]{bluetoothCore}

Anzumerken ist, dass jedes Attribut, welches in \ac{ATT} vorhanden ist, entweder in einer Dienstdeklarierung oder in einer Dienstdefinition enthalten sein soll. \cite[S.~1483]{bluetoothCore}

\todo[inline]{Bild hinzufügen}

Das \ac{GATT}-Profil soll von anderen Profilen als Grundstruktur verwendet werden, damit eine reibungslose Kommunikation zwischen einen Client und Server sichergestellt werden kann, wie in Abbildung \todo{Referenz hinzufügen} zu sehen ist. \cite[S.~1470]{bluetoothCore}

\todo[inline]{Bild hinzufügen}

Ein Dienst stellt unter \ac{GATT} eine Ansammlung von Daten dar, um ein bestimmtes Verhalten durch das vorhandene Gerät darzustellen. Ein Dienst kann zur Vereinfachung der Verhaltensdarstellung weitere Dienste inkludieren. Dienste können in zwei Gruppen eingeteilt werden. Zunächst einmal in die primären Dienste. Primäre Dienste bieten alleinstehende Funktionalitäten an. Im Gegensatz dazu gibt es sekundäre Dienste, welche optionale Funktionalitäten enthalten und von mindestens einen primären Dienst inkludiert werden müssen. \cite[S.~281]{bluetoothCore}

Die Definition eines Dienstes umfasst die inkludierten Dienste sowie die benötigten und optionalen Merkmale \cite[S.~1481]{bluetoothCore}.

Der Start eines Dienstes in der Liste der \ac{ATT}-Attribute wird durch ein spezielles Attribut festgelegt, mit dem Attribut-Typ \textit{primärer Dienst} oder \textit{sekundärer Dienst}. Das Ende eines Dienstes wird durch eine Folgedeklaration eines neuen Dienstes festgelegt. \cite[S.~1483]{bluetoothCore}

Merkmale sind Werte eines Dienstes welche aus mehreren \ac{ATT}-Attributen besteht. Ein Merkmal besteht aus drei Komponenten. Der Deklaration, den Eigenschaften des Merkmals und dem dazugehörigen Wert. Zusätzlich können noch Deskriptoren in einem Merkmal enthalten sein, um die Berechtigungen des Merkmals zu setzen. \cite[S.~281]{bluetoothCore}

Der Start eines Merkmals in der Liste der \ac{ATT}-Attribute wird durch ein spezielles Attribut festgelegt, welche den Attribut-Typ \textit{Merkmal} enthält. Das Ende eines Merkmals stellt eine neue Merkmaldeklaration oder eine neue Dienstdeklaration dar. \cite[S.~1484ff.]{bluetoothCore}

\subsection{Sollanforderungen durch Apple}
Im Apple Ökosystem muss Zubehör welches \ac{MFi} lizensierte Technologie, zum Verbindung zu Apple Geräte, verwendet -- beispielsweise \ac{MFi} Game Controller -- von Apple geprüft werden. Eine Ausnahme stellen dabei \ac{BLE}-Geräte dar. \cite{appleMfiProgram} Jedoch müssen diese Geräte einige Sollanforderungen im Bezug auf \ac{BLE} erfüllen. Eine Anforder ist, dass alle drei Advertising-Kanäle bei jeden Advertising Event verwendet werden sollen \cite[S.~186]{appleDesignGuide}. Dabei muss ein Advertising-Paket mindestens folgende Daten enthalten: TX Power Level, lokaler Name (ohne \textit{:} und \textit{;}), Flags und der primäre Dienst des Geräts \cite[S.~186f.]{appleDesignGuide}. Eine weitere Anforderung ist, dass die Advertising-Intervalle zunächst 20~ms für die ersten 30~Sekunden lang ist und danach auf andere Intervalle umgeschalten werden soll, welche in der Tabelle \cite[S.~187]{appleDesignGuide} stehen. Eine weitere Anforderung ist, dass keine speziellen Berechtigungen benötigt werden, um Dienste und Merkmale eines Gerätes zu endecken \cite[S.~190]{appleDesignGuide}. Auch soll auf den \ac{BLE}-Geräten der Geräteinformationsdienst implementiert sein, damit der Herstellername, die Modellnummer, die Firmwareversion und die Softwareversion ausgelsen werden kann \cite[S.~191]{appleDesignGuide}. Ebenso sollte Zubehör im \ac{GATT}-Profil das Merkmal mit dem Namen \textit{Gerätename} implementiert haben und durch das Apple-Gerät beschreibbar sein \cite[S.~190]{appleDesignGuide}. Als weitere Anforderung ist zu nennen, dass die Datenpacketlängenerweiterung vorhanden sein sollte, damit der Datenteil eines Pakets statt 27~Byte 251~Byte lang sein kann \cite[S.~189]{appleDesignGuide}. Die letzte Anforderung ist, dass auflösbare private Geräteadressen verwendet werden sollen \cite[S.~189]{appleDesignGuide}.

Auch geben Apple-Geräte nicht alle Dienste an Drittanbieter-Apps weiter, sondern verarbeitern diese intern und geben daraufhin die verarbeiteten Daten an die Drittanbieter-Apps weiter. Die herausgefilteren Dienste sind: \ac{GAP}, \ac{GATT} sowie \ac{BLE} \ac{HID}. \cite[S.~192]{appleDesignGuide}

\subsection{\acf{HOGP}}
In diesen Abschnitt der Arbeit, wird nur auf die Anforderungen eines \acs{HID}-Geräts -- stellt einen \acs{GATT}-Server bereit \cite[S.~9]{bluetoothHOGP} -- und nicht eines \acs{HID}-Hosts -- stellt einen \acs{GATT}-Client bereit \cite[S.~9]{bluetoothHOGP} --, da eine Implementierung des \acs{HID}-Hosts nicht in diesem Projekt benötigt werden.

Mittels dem \acl{HOGP} werden Prozeduren und Fähigkeiten definiert, welches ein \acs{BLE}-\acs{HID} fähiges Gerät benötigt, um als \acs{HID}-Gerät von \acs{HID}-Host wargenommen zu werden. Das Profil ist passt dafür die USB \acs{HID} Spezifikation für \ac{BLE} an. \cite[S.~9]{bluetoothHOGP}

Als Abhängigkeiten hat das \acf{HOGP} weiter Profile und Dienste, welche auf einen \acs{HID}-Gerät implementiert sein müssen. Dazu zählen das \acs{GATT}, der Batteriedienst, der Geräteinformationsdiesnt, das Scan Parameters Profil und der \acs{HID} Dienst. Dabei ist zu beachten, dass auf einen \acs{HID}-Gerät ein oder mehrere Instanzen des \acs{HID}-Dienstes, ein oder mehrere Instanzen des Batteriedienstes, sowie nur eine Instanz des Gerätinformationsdienstes und optional eine Instanz des Scan Parameters Dienstes laufen darf. \cite[S.~9, S.~11]{bluetoothHOGP} In Abbildung \todo{referenz einfügen} sind alle benötgiten und optionalen Dienste grafisch dargestellt. Optionale Dienste werden dabei durch eine gestrichelte Linie angedeutet.

\todo[inline]{Bild einfügen}

Auch werden im \acl{HOGP} für alle benötigten Dienste und Profile zusätzliche Bedingungen gesetzt. Diese werden in folgenden Unterkapiteln bei dem jeweiligen Dienst beziehungsweise Profil dargelegt.

\subsubsection{\ac{HID}-Dienst}

Der \acs{HID}-Dienst ist auf \acs{HID}-Geräten zuständig, um alle benötigten Daten für einen \acs{HID}-Host bereitszustellen. Dabei ist zu beachten, dass alle gespeicherten Merkmale des \acs{GATT}-Servers mit dem niederwertigsten Oktett zuerst übertragen werden müssen. Auch muss der Dienst für den standardkonformen Betrieb mindestens die Merkmale \textit{Report Map}, \textit{HID Information} und \textit{HID Control Point} implementiert haben. \cite[S.~8ff.]{bluetoothHIDS}

\subsubsubsection{Report Merkmal}
Das Merkmal \textit{Report} ist optional. Dieses stellt jedoch ein wichtiges Merkmal dar, da der Datentransfer zwischen \acs{HID}-Gerät und \acs{HID}-Host hauptsächlich über dieses Merkmal stattfindent. Das Merkmal \textit{Report}, kann dabei einen von drei Typen annehmen, nämlich Eingabe, Ausgabe oder Feature. Diese Typen finden sich ebenso in der USB \acs{HID} Sepifikation wieder. \cite[S.~11f.]{bluetoothHIDS}

Da ein \acs{HID}-Gerät mehrere Reports haben kann, muss für jeden Report ein eigenes Merkmal erstellt werden. Zu Unterscheidung der verschiedenen Reports muss jeweils ein Referenz-Merkmalsdeskriptor hinzugefügt werden, welche eine eindeutige Report-ID und den Report-Typen enthält. Als zusätzliche Bedingung müssen in allen Report-Merkmalen vom Typ Eingabe ein Konfigurationsdeskriptor vorhanden sein. Mittels diesen Deskiptor kann konfiguriert werden, ob bei Änderung des Merkmalswerts der \acs{HID}-Host informiert werden soll oder nicht. Diese Angabe ist desweiteren verpflichtend. \cite[S.~14.f]{bluetoothHIDS}

\subsubsubsection{Report Map Merkmal}
In dem Merkmal \textit{Report Map}, wir der USB Report Deskriptor abgespeichert (wie in der USB \acs{HID} Spezifikation definiert \cite[S.~21]{bluetoothHOGP}), welcher den Aufbau und die Formatierung der einzelnen Report-Merkmale enthält \cite[S.~11]{bluetoothHIDS}. Pro \acs{HID}-Dienst darf nur jeweils nur eine Instanz dieses Merkmals vorhanden sien und die maximale Größe ist auf 512~Oktette beschränkt \cite[S.~16]{bluetoothHIDS}. Mittels dem zusätzlich benötigten \textit{Report Referenz}-Merkmalsdeskriptors ist es den \acs{HID}-Hosts möglich die Informationen des \textit{Report Map} Merkmals mit den \textit{Report} Merkmalen zu verknüpfen \cite[S.~17]{bluetoothHIDS}.

\subsubsubsection{\ac{HID} Information Merkmal}
Dieses Merkmal enthält eine Ansammlung von Informationenen welche \acs{HID} spezifische Werte sind. Zwei beispielhafte Werte welche in diesem Merkmal enthalten sind, ist zum einen der Wert \textit{bcdHID}. Dieser wird verwendet, um den \acs{HID}-Host anzuzeigen, welche USB-Spezifikation im \acs{HID}-Gerät implementiert wurde. Zum anderen gibt es den Wert \textit{bCountryCode}. Mit diesem Wert wird angegeben,für welches Land das \acs{HID}-Gerät entwickelt wurde. Da Geräte meist nich für ein spezielles Land entwickelt werden steht dieser Wert häufig auf 0x00. Das \textit{\acs{HID} Information} Merkmal darf pro \acs{HID} Dienst nur einmal vorkommen und die Daten müssen statisch sein. \cite[S.~20f.]{bluetoothHIDS}

\subsubsubsection{\ac{HID} Control Point Merkmal}
Dieses Merkmal wird von \acs{HID}-Hosts verwendet, um \acs{HID}-Geräte in den Schlafmodus und in den normalen Betrieb zu versetzen. Dieses Merkmal darf nur einmal pro \acs{HID} Dienst vorkommen. \cites[S.~23]{bluetoothHOGP}[S.~21]{bluetoothHIDS}

\subsubsubsection{Zusätzliche Bedingungen durch das \acl{HOGP}}
Alle Merkmale die in dem \textit{Report Map} Merkmal veschrieben sind und nicht im \acs{HID} Dienst enthalten sind, sollen mittels eines \textit{Includes} in der \acs{HID} Dienst Definition referenziert werden. Zusätzlich müssen alle referenzierten Merkmale den \textit{Report Referenz} Merkmaldeskriptor enthalten. Auch müssen alle \acs{HID}-Dienste als primärer Dienst initialisiert werden und während der Entdeckungsphase für einen Verbindungsaufbau als möglicher Dienst angegeben werden. \cite[S.~13f.]{bluetoothHOGP}

\subsubsection{Batteriedienst}
Mittels diesem Dienst wird dem \acs{GATT}-Host der aktuelle Batteriestatus einer oder mehrerer Batterien des \acs{GATT}-Servers bereitgestellt. Dabei gilt es zu beachten, dass alle bereitgestellten Merkmale des \acs{GATT}-Servers mit dem niederwertigsten Oktett zuerst übertragen werden. \cite[S.~6]{bluetoothBatteryS}

Für diesen Dienst muss ein Merkmal mit den Namen \textit{Battery Level} implementiert werden. Der Batteriestand wird dabei als ein Prozentwert zwischen 0 und 100 angegben. Wobei 100\% einer voll aufgelandenen Batterie entspricht. Zusätzlich kann das Merkmal so eingerichtet werden, dass der \acs{GATT}-Server den \acs{GATT}-Client informiert sobald sich der Wert geändert hat. \cite[S.~8]{bluetoothBatteryS}

\subsubsubsection{Zusätzliche Bedingungen durch das \acl{HOGP}}
Es muss mindestens ein Batteriedienst als primärer Dienst auf dem \acs{HID}-Gerät laufen. Falls ein Batteriestandsmerkmal Bestandteil des \textit{Report Map} Merkmals ist, muss der Dienst mittels eines \textit{Include} in der \acs{HID} Dienst Definition referenziert werden. \cite[S.~14]{bluetoothHOGP}

\subsubsection{Geräteinformationsdienst}
Dieser Dienst stellt einen \acs{GATT}-Client Informationen über den Hersteller und Anbieter des \acs{GATT}-Server bereit. Dabei darf jedes verfügbare Merkmal nur einmalig pro Dienst vorkommen. Zu beachten ist, dass alle Merkmale optional sind. \cite[S.~6ff.]{bluetoothDeviceI}. In Tabelle \ref{table:deviceinformationlist} sind alle vorhanden Merkmale mit einer kurzen Beschreibung aufgelistet.

\begin{longtable}[c]{|p{4cm}|p{11cm}|}
    \caption{Liste der verfügbaren Geräteinformationsmerkmale}
    \label{table:deviceinformationlist}\\
    \hline
    \textbf{Merkmalname} & \textbf{Kurzbeschreibung}\\
    \hline
    \hline
    \endfirsthead

    \caption{Fortsetzung der verfügbaren Merkmale}\\
    \hline
    \textbf{Merkmalname} & \textbf{Kurzbeschreibung}\\
    \hline
    \hline
    \endhead

    \hline
    \multicolumn{2}{|r|}{Weitere Merkmale auf der nächsten Seite}\\
    \hline
    \endfoot

    \hline
    \endlastfoot
    
    Herstellername & Enthält den Namen des Herstellers \cite[S.~8]{bluetoothDeviceI}\\
    \hline
    Modellnummer & Enthält die Modellnummer des Geräteanbieters \cite[S.~8]{bluetoothDeviceI}\\
    \hline
    Seriennummer & Enthält die Seriennummer des Geräts \cite[S.~8]{bluetoothDeviceI}\\
    \hline
    Hardwareversion & Enthält die Hardwareversion \cite[S.~9]{bluetoothDeviceI}\\
    \hline
    Firmwareversion & Enthält die Firmwareversion \cite[S.~9]{bluetoothDeviceI}\\
    \hline
    Softwareversion & Enthält die Softwareversion \cite[S.~9]{bluetoothDeviceI}\\
    \hline
    System-ID & Enthält eine Komination aus organisatorischer UID und herstellerdefinierte ID. Diese ID ist eindeutig für jedes Gerät eines Produkts \cite[S.~9]{bluetoothDeviceI}\\
    \hline
    IEEE 11073-20601 Regulatory Certification Data Liste & Enthält eine Liste aller Regulations- und Zertifizierungsinfromationen des Produkts \cite[S.~9]{bluetoothDeviceI}\\
    \hline
    PNP-ID & Enthält eine eindeutige Geräte-ID. Diese bestht aus der Anbieter-ID-Quelle (Angabe, ob die Anbieter-ID durch Bluetooth~SIG oder USB Implementer's Forum festgelet wurde), der Anbieter-ID, der Produkt-ID (von Anbieter festgelegt) und einer Produktversion. Die Produktversion wird als binär-kodierte Dezimalzahl dargestellt. Zum Beispiel Version 2.13 = 0x0213 \cite[S.~10f.]{bluetoothDeviceI}\\
\end{longtable}

\subsubsubsection{Zusätzliche Bedingungen durch das \acl{HOGP}}
Der Dienst muss als primärer Dienst gestartet werden und muss das \textit{PNP-ID} Merkmal enthalten. \cite[S.~14f.]{bluetoothHOGP}

\subsubsection{Scan Parameters Profil}
Mittels diesem optionalen Profil beziehungsweise Dienst, stellt ein \acs{GATT}-Server einen \acs{GATT}-Client Informationen zur Verfügung, die die Geräte unterstützen bei der Verwaltung von Verbindungszeitüberschreitungen und den Advertising Paketen. Durch diese Informationen kann der Stromverbrauch sowie die Wiederverbindungslatenz optimiert werden. \cite[S.~6]{bluetoothScan}

\subsection{Bluetooth-Stacks}
\todo[inline]{TODO}
\subsubsection{Bluedroid}
\subsubsection{NimBLE}

\section{Übertragungsprotokolle am Fernbedienungsmodulschacht}

\subsection{\acf{PPM}}

\subsection{CRSF}

\subsection{SBUS}

\subsection{MULTI}

\section{Mikrocontroller ESP}
mehrere Kerne; Pins; Kommunikationsmöglichkeiten; CE z
Zertifizierung (da Antenne schon vorhanden muss nicht erneut zertifiziert werden)

\section{FreeRTOS}
sheduling und Kommunikation zwischen Tasks, interrupts und priorisierung

\section{BITMAP Schriftarten}

\section{libevdev}